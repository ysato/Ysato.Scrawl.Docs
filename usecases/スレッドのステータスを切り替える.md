#### ユースケース名: スレッドのOpen/Closedを切り替える

* **アクター:** 登録ユーザー (ログインユーザー)
* **目的:** 自身のスレッドのトピック進行状況を「Open」または「Closed」に切り替える。
* **関連するHTMLモック画面:** 自身のスレッド詳細画面 (スレッドのステータス表示と切り替えUIが組み込まれる想定)

---

**1. 事前条件:**

* ユーザーはWebアプリケーションにログインしている。
* ユーザーは自身のスレッド詳細画面を閲覧している。
* 閲覧しているスレッドは、現在ログインしているユーザーが作成したものである。
* スレッド詳細画面には、スレッドの現在のOpen/Closedステータスを表示し、切り替えを行うためのUI（例: ボタン、トグルスイッチなど）が存在する。

**2. 基本的な流れ（正常系）:**

1. **ユーザーは自身のスレッド詳細画面を開く。**
2. **ユーザーはスレッドのOpen/Closedステータスを切り替えるためのUI（例: 「Closeする」ボタン、またはトグルスイッチ）を操作する。**
    * システムは、切り替え操作を受け付ける。
3. **システムは操作ユーザーとスレッド作成ユーザーが一致するかをバックエンドで検証する。**
4. **検証が成功した場合、システムはデータベースの該当スレッドのステータス（例: `status`
   カラムの値）を「Open」から「Closed」、または「Closed」から「Open」に更新する。**
    * **「Closed」状態であっても、スクラッチの追加は引き続き可能である。**
5. **システムはスレッド詳細画面のUI表示を更新されたステータスに切り替える。**

---

**3. 代替の流れ（例外系、エラーなど）:**

* **A. 自身のスレッド以外を操作しようとした場合:**
    1. ユーザーが他のユーザーのスレッドのOpen/Closed切り替えUIを操作する。（UI上で制限されているが、バックエンドでの検証を想定）
    2. システムは操作ユーザーとスレッド作成ユーザーが一致しないことを検知する。
    3. システムはエラーメッセージ（例: 「他のユーザーのスレッドのステータスは変更できません」）を表示し、処理を中断する。
* **B. 存在しないスレッドのステータスを変更しようとした場合:**
    1. ユーザーが何らかの理由で、既に削除されたスレッドのステータスを変更しようとする。
    2. システムは該当スレッドが見つからないことを検知する。
    3. システムはエラーメッセージ（例: 「指定されたスレッドは見つかりません」）を表示し、処理を中断する。
* **C. システムエラーが発生した場合:**
    1. ユーザーがステータスの切り替え操作を行う。
    2. データベース更新中に予期せぬエラーが発生する。
    3. システムは一般的なエラーメッセージ（例: 「ステータスの変更中にエラーが発生しました。時間をおいて再度お試しください。」）を表示し、ステータスは変更されない。

---

**4. 事後条件:**

* スレッドのステータスが正常に更新された場合: データベースの該当スレッドのステータスが変更され、ユーザーはスレッド詳細画面で新しいステータスを確認できる。
* スレッドのステータスが変更されなかった場合: ユーザーはスレッド詳細画面に留まり、エラーメッセージが表示される。

